<html>
  <head>
    <title>JupyterLite in an iframe</title>
    <script type="module">
      import { createBridge } from './jupyter-iframe-commands-host.js';

      // Create a bridge to the JupyterLite instance
      const commandBridge = createBridge({ iframeId: 'jupyter-iframe' });

      // Example: Toggle the left sidebar
      async function toggleLeftSidebar() {

        console.log("Opened console1");
        await commandBridge.execute('console:inject', {
          path: 'iframe_console', 
          code: 'import numpy as np;from matplotlib import pyplot as plt;x, y, scale = np.random.randn(3, 100);fig, ax = plt.subplots();ax.scatter(x=x, y=y, c=scale, s=np.abs(scale) * 500);plt.show()'
        });
        console.log("Injected code into console1");
      }

      // Example: Change the theme
      async function setDarkTheme() {
        await commandBridge.execute('apputils:change-theme', {
          theme: 'JupyterLab Dark',
        });
      }

      // List all available JupyterLab commands
      async function listCommands() {
        const commands = await commandBridge.listCommands();
        console.log(commands);
      }

      // Make functions available globally
      window.toggleLeftSidebar = toggleLeftSidebar;
      window.setDarkTheme = setDarkTheme;
      window.listCommands = listCommands;
    </script>
  </head>
  <body>
    <h2>JupyterLite with command bridge</h2>
    <div>
      <button onclick="toggleLeftSidebar()">Toggle Left Sidebar</button>
      <button onclick="setDarkTheme()">Set Dark Theme</button>
      <button onclick="listCommands()">List Commands (check console)</button>
    </div>



    <iframe
      id="jupyter-iframe"
      src="jupyter/repl/index.html?kernel=python&clearCellsOnExecute=1&hideCodeInput=1&clearCodeContentOnExecute=1&showBanner=0&code=print('hello')"
      width="100%"
      height="600px"
      sandbox="allow-scripts allow-same-origin"
    ></iframe>
  </body>
</html>